{% extends "store/base.html" %}
{% load static %}
{% block title %}Soumettre votre texte — Kit de préparation{% endblock %}

{% block content %}
<div class="max-w-3xl mx-auto px-4 py-12">
  <h1 class="text-2xl md:text-3xl font-bold text-brand-600">Soumettre votre texte (jusqu’à 3 pages)</h1>
  <p class="mt-2 text-slate-700">Vous pouvez coller votre texte ou joindre un fichier (PDF/Word jusqu’à ~5&nbsp;Mo).</p>

  {% if error %}
    <div class="mt-4 rounded-lg border border-red-200 bg-red-50 px-4 py-3 text-red-700">
      {{ error }}
    </div>
  {% endif %}

  <form class="mt-6 space-y-4" method="post" action="{% url 'store:bonus_submit' %}" enctype="multipart/form-data">
    {% csrf_token %}

    <!-- Email d’achat -->
    <div class="rounded-lg border p-4 space-y-2">
      <label for="email" class="font-semibold">Email d’achat</label>
      <input id="email" type="email" name="email" required
             value="{{ prefill.email|default:'' }}"
             class="w-full rounded-xl border px-4 py-3" placeholder="ex: vous@domaine.tld">
    </div>

    <!-- Achat interne/externe + référence commande -->
    <div class="rounded-lg border p-4 space-y-2" x-data="{ ext: false }"
         x-init="{% if prefill.is_external == 'on' %}ext = true{% endif %}">
      <div x-data="{ ext: false }" x-init="{% if prefill.is_external == 'on' %}ext = true{% endif %}">
          <label class="inline-flex items-center gap-2">
            <input type="checkbox" name="is_external" x-model="ext" x-bind:checked="ext" />
            <span>Acheté via une plateforme externe (Selar / YouScribe / autre)</span>
          </label>
      </div>

      <!-- Interne : demande la référence -->
      <div class="mt-3 space-y-2" x-show="!ext" x-cloak>
        <label for="order_ref" class="font-semibold">Référence de commande (site)</label>
        <input id="order_ref" type="text" name="order_ref" value="{{ prefill.order_ref|default:'' }}"
               class="w-full rounded-xl border px-4 py-3" placeholder="ex: SCD8LJ">
        <p class="text-xs text-slate-500">Format attendu : commence par <strong>SC…</strong> (ex&nbsp;: <code>SCD8LJ</code>).</p>
      </div>

      <!-- Externe : info -->
      <div class="mt-3 text-sm text-slate-600" x-show="ext" x-cloak>
        Validation via votre <strong>email d’achat</strong> uniquement (contrôle partenaires).
      </div>
    </div>

    <!-- Zone de texte + fichier -->
    <div class="rounded-lg border p-4 space-y-2">
      <label for="text_input" class="font-semibold">Votre texte (jusqu’à 3 pages)</label>
      <textarea id="text_input" name="text_input" rows="8" class="w-full rounded-xl border px-4 py-3"
                placeholder="Collez votre texte ici…">{{ prefill.text_input|default:'' }}</textarea>
      <p class="text-xs text-slate-500">Ou joignez un fichier (PDF, DOC, DOCX, ODT) :</p>
      <input type="file" name="doc_file" accept=".pdf,.doc,.docx,.odt" class="block w-full rounded-xl border px-4 py-2">
    </div>

    <!-- Actions -->
    <div>
      <button type="submit" class="rounded-xl bg-brand-600 px-6 py-3 text-white font-semibold hover:bg-brand-700">
        Envoyer la demande
      </button>
      <a href="{% url 'store:bonus_landing' %}"
         class="ml-3 inline-flex items-center rounded-xl border px-5 py-3 hover:bg-slate-50">
        Annuler
      </a>
    </div>
  </form>
</div>
{% endblock %}
