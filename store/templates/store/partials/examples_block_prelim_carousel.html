<!-- store/templates/store/partials/examples_block_prelim_carousel.html -->
<div x-data="{i:0, n: {{ tables|length }}}" x-cloak class="text-slate-800">
    {% if tables %}
      {% for t in tables %}
      <div x-show="i==={{ forloop.counter0 }}" x-transition.opacity.duration.200ms>
  
        <!-- En-tête de section (léger, sans card) -->
        <div class="pb-2 border-b border-slate-200">
          <div class="flex items-start justify-between gap-3">
            <div>
              <div class="text-[11px] font-semibold uppercase tracking-wide text-slate-500">
                Analyse préliminaire
              </div>
              <h2 class="text-lg md:text-xl font-bold text-slate-900">
                {{ t.title }}
              </h2>
              {% if t.description %}
                <p class="mt-1 text-sm text-slate-600">
                  {{ t.description }}
                </p>
              {% endif %}
            </div>
            <span class="shrink-0 h-6 inline-flex items-center px-2 rounded-full bg-slate-900 text-white text-[11px] font-semibold">
              {{ t.get_group_display }}
            </span>
          </div>
        </div>
  
        <!-- Tableau -->
        <div class="mt-3 overflow-x-auto">
          <table class="min-w-full text-sm">
            <thead class="sticky top-0 z-10 bg-black/95 text-white border-b border-black">
              <tr class="text-left">
                <th class="px-3 py-2 font-semibold">Irrégularité</th>
                <th class="px-3 py-2 font-semibold">Référence</th>
                <th class="px-3 py-2 font-semibold">Acteurs concernés</th>
                <th class="px-3 py-2 font-semibold">Dispositions pratiques</th>
              </tr>
            </thead>
            <tbody class="divide-y divide-slate-200/70">
              {% for r in t.rows.all|slice:":5" %}
              <tr class="align-top odd:bg-slate-50/60 even:bg-white hover:bg-blue-50/40 transition-colors">
                <td class="px-3 py-2 font-medium text-slate-900">{{ r.irregularity }}</td>
                <td class="px-3 py-2 text-slate-700">{{ r.reference|default:"—" }}</td>
                <td class="px-3 py-2 text-slate-700">{{ r.actors|default:"—" }}</td>
                <td class="px-3 py-2 text-slate-700 whitespace-pre-line">{{ r.dispositions }}</td>
              </tr>
              {% empty %}
              <tr>
                <td colspan="4" class="px-3 py-3 text-slate-500">
                  Aucune ligne pour cette table.
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
          <p class="mt-1 text-xs text-slate-500">
            Extrait limité à 5 lignes. Voir l’ebook pour la version complète.
          </p>
        </div>
      </div>
      {% endfor %}
  
      <!-- Navigation carrousel -->
      <div class="mt-4 flex items-center justify-between" x-show="n>0">
        <div class="flex items-center gap-2">
          <button @click="i=(i-1+n)%n" class="px-3 py-1.5 rounded-lg border border-slate-200 hover:bg-slate-50">Préc.</button>
          <button @click="i=(i+1)%n" class="px-3 py-1.5 rounded-lg border border-slate-200 hover:bg-slate-50">Suiv.</button>
        </div>
        <div class="flex items-center gap-2">
          <template x-for="idx in [...Array(n).keys()]" :key="idx">
            <button @click="i=idx" class="h-2.5 w-2.5 rounded-full transition" :class="i===idx ? 'btn' : 'bg-slate-300'"></button>
          </template>
        </div>
      </div>
    {% else %}
      <p class="text-sm text-slate-600">Aucune analyse préliminaire enregistrée.</p>
    {% endif %}
  </div>
  
