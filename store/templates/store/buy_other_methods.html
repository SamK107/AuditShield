{% extends "store/base.html" %}
{% load static %}

{% block title %}Autres moyens d’achat — Audit sans peur{% endblock %}

{% block content %}
<main class="w-full">
  <!-- Palette brand locale -->
  <style>
    :root{
      --brand-600:#155E75; --brand-700:#0E4A60; --brand-50:#E6F4F7;
      --ink:#0F172A; --muted:#475569; --ring:rgba(21,94,117,.35);
      --note:#C2410C; /* orange-700 pour la note */
    }
    .bg-brand-600{background-color:var(--brand-600)}
    .hover\:bg-brand-700:hover{background-color:var(--brand-700)}
    .text-brand-600{color:var(--brand-600)}
    .ring-brand-600{--tw-ring-color:var(--brand-600)}
  </style>

  <!-- Bandeau header (on conserve l’espace) -->
  <section class="relative">
    <div class="absolute inset-0 bg-gradient-to-b from-[var(--brand-50)]/70 via-white to-white pointer-events-none"></div>
    <div class="relative max-w-6xl mx-auto px-4 md:px-6 lg:px-8 pt-6 pb-2">
      <div class="h-4"></div>
      <h1 class="mt-0 text-2xl md:text-3xl font-extrabold tracking-tight text-[color:var(--ink)]">
        Autres moyens d’achat
      </h1>
    </div>
  </section>

  <!-- Contenu compact -->
  <div class="relative max-w-6xl mx-auto px-4 md:px-6 lg:px-8 pb-8">
    <!-- Barre info : sécurisé + instantané + NOTE orange -->
    <div class="mt-2 rounded-lg border border-slate-200 bg-slate-50/70 px-3 py-2 text-[13px] text-slate-700 flex flex-wrap items-center gap-x-3 gap-y-1">
      <span class="inline-flex items-center gap-1.5">
        <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 text-brand-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path d="M12 3l8 4v6c0 5-8 8-8 8s-8-3-8-8V7l8-4z"/>
        </svg>
        Transactions protégées
      </span>
      <span class="opacity-60">•</span>
      <span class="inline-flex items-center gap-1.5">
        <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 text-brand-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path d="M12 6v6l4 2"/>
        </svg>
        Accès immédiat après achat
      </span>
      <span class="opacity-60">•</span>
      <span class="text-brand-600 font-medium">
        Après achat, l’ebook contient des liens sécurisés vers vos bonus sur auditsanspeur.com.
      </span>
    </div>

    <!-- Grille responsive 1→2 colonnes ; cards compactes & égales en hauteur -->
    <div class="mt-5 grid grid-cols-1 sm:grid-cols-2 gap-4 md:gap-5 auto-rows-fr">

      {# --- CAS 1 : EXTERNAL_BUY_LINKS['produit'] dict --- #}
      {% if platforms.items %}
        {% for key, p in platforms.items %}
          {% with k=key|lower %}
          <article class="h-full flex flex-col rounded-xl border border-slate-200 bg-slate-50 hover:bg-white shadow-sm hover:shadow-md transition p-4 md:p-5">
            <header class="flex items-start justify-between gap-3">
              <div class="flex items-center gap-3 min-w-0">
                {% if p.logo %}
                  <img src="{{ p.logo }}" alt="{{ p.label|default:key|title }} logo"
                       class="h-8 w-8 rounded-md border border-slate-200 bg-white shadow-sm object-contain"
                       loading="lazy" decoding="async">
                {% else %}
                  <img src="{% static 'partners/' %}{{ k }}.svg" alt="{{ p.label|default:key|title }} logo"
                       class="h-8 w-8 rounded-md border border-slate-200 bg-white shadow-sm object-contain"
                       loading="lazy" decoding="async" onerror="this.style.display='none'">
                {% endif %}
                <h2 class="text-base md:text-[17px] font-semibold truncate">
                  {{ p.label|default:key|title }}
                </h2>
              </div>
              {% if p.badge %}
                <span class="shrink-0 rounded-full border border-emerald-200 bg-emerald-50 px-2 py-0.5 text-[11px] font-medium text-emerald-800">
                  {{ p.badge }}
                </span>
              {% endif %}
            </header>

            {% if p.description %}
              <p class="mt-2 text-[13.5px] leading-snug text-[color:var(--muted)] line-clamp-2">
                {{ p.description }}
              </p>
            {% endif %}

            <!-- Footer poussé en bas pour égaliser la hauteur -->
            <footer class="mt-auto pt-3 flex items-center justify-between">
              <ul class="flex items-center gap-2 text-[11.5px] text-slate-500">
                <li class="inline-flex items-center gap-1">
                  <svg xmlns="http://www.w3.org/2000/svg" class="w-3.5 h-3.5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path d="M12 3l8 4v6c0 5-8 8-8 8s-8-3-8-8V7l8-4z"/>
                  </svg> Sécurisé
                </li>
                <li class="inline-flex items-center gap-1">
                  <svg xmlns="http://www.w3.org/2000/svg" class="w-3.5 h-3.5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path d="M12 6v6l4 2"/>
                  </svg> Instantané
                </li>
              </ul>
              <a href="{{ p.url }}"
                 class="inline-flex items-center gap-1.5 rounded-lg bg-brand-600 text-white px-3 py-1.5 hover:bg-brand-700 focus:outline-none focus:ring-2 focus:ring-offset-1 ring-brand-600 transition text-[13px]"
                 target="_blank" rel="noopener" aria-label="Continuer">
                Continuer
                <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path d="M7 17L17 7M7 7h10v10"/>
                </svg>
              </a>
            </footer>
          </article>
          {% endwith %}
        {% endfor %}

      {# --- CAS 2 : liste normalisée --- #}
      {% else %}
        {% for p in platforms %}
          {% with k=p.key|default:''|lower %}
          <article class="h-full flex flex-col rounded-xl border border-slate-200 bg-slate-50 hover:bg-white shadow-sm hover:shadow-md transition p-4 md:p-5">
            <header class="flex items-start justify-between gap-3">
              <div class="flex items-center gap-3 min-w-0">
                {% if p.logo %}
                  <img src="{{ p.logo }}" alt="{{ p.label|default:p.key|title }} logo"
                       class="h-8 w-8 rounded-md border border-slate-200 bg-white shadow-sm object-contain"
                       loading="lazy" decoding="async">
                {% else %}
                  <img src="{% static 'partners/' %}{{ k }}.svg" alt="{{ p.label|default:p.key|title }} logo"
                       class="h-8 w-8 rounded-md border border-slate-200 bg-white shadow-sm object-contain"
                       loading="lazy" decoding="async" onerror="this.style.display='none'">
                {% endif %}
                <h2 class="text-base md:text-[17px] font-semibold truncate">
                  {{ p.label|default:p.key|title }}
                </h2>
              </div>
              {% if p.badge %}
                <span class="shrink-0 rounded-full border border-emerald-200 bg-emerald-50 px-2 py-0.5 text-[11px] font-medium text-emerald-800">
                  {{ p.badge }}
                </span>
              {% endif %}
            </header>

            {% if p.description %}
              <p class="mt-2 text-[13.5px] leading-snug text-[color:var(--muted)] line-clamp-2">
                {{ p.description }}
              </p>
            {% endif %}

            <footer class="mt-auto pt-3 flex items-center justify-between">
              <ul class="flex items-center gap-2 text-[11.5px] text-slate-500">
                <li class="inline-flex items-center gap-1">
                  <svg xmlns="http://www.w3.org/2000/svg" class="w-3.5 h-3.5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path d="M12 3l8 4v6c0 5-8 8-8 8s-8-3-8-8V7l8-4z"/>
                  </svg> Sécurisé
                </li>
                <li class="inline-flex items-center gap-1">
                  <svg xmlns="http://www.w3.org/2000/svg" class="w-3.5 h-3.5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path d="M12 6v6l4 2"/>
                  </svg> Instantané
                </li>
              </ul>
              <a href="{{ p.url }}"
                 class="inline-flex items-center gap-1.5 rounded-lg bg-brand-600 text-white px-3 py-1.5 hover:bg-brand-700 focus:outline-none focus:ring-2 focus:ring-offset-1 ring-brand-600 transition text-[13px]"
                 target="_blank" rel="noopener" aria-label="Continuer">
                Continuer
                <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path d="M7 17L17 7M7 7h10v10"/>
                </svg>
              </a>
            </footer>
          </article>
          {% endwith %}
        {% empty %}
          <div class="rounded-xl border border-amber-200 bg-amber-50/70 p-4">
            <div class="text-[15px] font-medium text-amber-900">Aucune plateforme configurée</div>
            <p class="mt-0.5 text-[12.5px] text-amber-800">
              Ajoutez-les dans <code>EXTERNAL_BUY_LINKS["produit"]</code> dans vos settings.
            </p>
          </div>
        {% endfor %}
      {% endif %}
    </div>
  </div>
</main>

<!-- Init icônes si nécessaire -->
<script>
  document.addEventListener('DOMContentLoaded', () => {
    if (window.lucide && window.lucide.createIcons) window.lucide.createIcons();
  });
</script>
{% endblock %}
