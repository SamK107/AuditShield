{% extends "base.html" %}
{% block title %}TÃ©lÃ©chargements â€” {{ order.product.title }}{% endblock %}

{% block content %}
<main class="max-w-3xl mx-auto px-4 py-8">
  <header class="mb-4">
    <h1 class="text-2xl md:text-3xl font-extrabold">TÃ©lÃ©chargements â€“ {{ order.product.title }}</h1>
    <p class="mt-1 text-sm text-slate-600">CommandeÂ : <strong class="font-semibold">{{ order.uuid }}</strong> â€” EmailÂ : {{ order.email }}</p>
  </header>

  {% if messages %}
    <div class="mb-4 rounded-xl border border-blue-200 bg-blue-50 px-4 py-3 text-blue-900">
      <ul class="list-disc pl-5 space-y-1">
        {% for message in messages %}
          <li>{{ message }}</li>
        {% endfor %}
      </ul>
    </div>
  {% endif %}

  <section class="rounded-2xl border border-slate-200 bg-white p-5 shadow-sm">
    <div class="mb-3 text-slate-800">
      <p class="font-semibold">FÃ©licitations pour votre achat ğŸ‰</p>
      <p class="mt-1">Voici les liens de tÃ©lÃ©chargement de votre ebook en deux formatsÂ :</p>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <div class="rounded-xl border border-slate-200 p-4 bg-slate-50">
        <h3 class="font-bold">PDF A4</h3>
        <p class="mt-1 text-sm text-slate-600">
          IdÃ©al pour lâ€™impression et la lecture sur ordinateurÂ : marges confortables, pagination optimisÃ©e A4.
        </p>
        {% for a in assets %}
          {% if "A4" in a.title or "a4" in a.title %}
            <a href="{% url 'downloads:asset' a.id %}"
               class="mt-3 inline-flex items-center gap-2 rounded-lg bg-brand-600 px-3 py-2 text-white hover:bg-brand-700 focus:outline-none focus:ring-2 focus:ring-brand-600">
              Audit Sans Peur {{ a.title }}
            </a>
          {% endif %}
        {% endfor %}
      </div>

      <div class="rounded-xl border border-slate-200 p-4 bg-slate-50">
        <h3 class="font-bold">PDF 6Ã—9</h3>
        <p class="mt-1 text-sm text-slate-600">
          Format â€œlivreâ€ compactÂ : lecture agrÃ©able sur mobile/liseuse, fichier plus lÃ©ger.
        </p>
        {% for a in assets %}
          {% if "6x9" in a.title|lower or "6Ã—9" in a.title %}
            <a href="{% url 'downloads:asset' a.id %}"
               class="mt-3 inline-flex items-center gap-2 rounded-lg bg-brand-600 px-3 py-2 text-white hover:bg-brand-700 focus:outline-none focus:ring-2 focus:ring-brand-600">
              Audit Sans Peur {{ a.title }}
            </a>
          {% endif %}
        {% endfor %}
      </div>
    </div>

    {% if assets|length == 0 %}
      <p class="mt-3 text-sm text-amber-700 bg-amber-50 border border-amber-200 rounded-lg px-3 py-2">
        Les fichiers ne sont pas encore publiÃ©s. Merci de rÃ©essayer plus tard.
      </p>
    {% endif %}
  </section>

  <section class="mt-5 rounded-2xl border border-slate-200 bg-white p-5 shadow-sm">
    <p class="text-slate-800">
      Un email vient de vous Ãªtre envoyÃ© avecÂ :
    </p>
    <ul class="mt-2 list-disc pl-5 text-sm text-slate-700 space-y-1">
      <li>le lien vers la page unique listant toutes les ressources</li>
      <li>le lien pour dÃ©marrer le bonus â€œKit de prÃ©parationâ€</li>
    </ul>

    <div class="mt-4 flex flex-wrap items-center gap-3">
      <a href="{% url 'downloads:resources' order.uuid %}"
         class="inline-flex items-center gap-2 rounded-lg bg-slate-900 px-3 py-2 text-white hover:bg-black focus:outline-none focus:ring-2 focus:ring-slate-900">
        Ressources tÃ©lÃ©chargeables
      </a>
      <form method="post" action="{% url 'downloads:resend_fulfilment' order.uuid %}">
        {% csrf_token %}
        <button type="submit"
                class="inline-flex items-center gap-2 rounded-lg bg-blue-600 px-3 py-2 text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-600">
          M'envoyer les liens de tÃ©lÃ©chargement
        </button>
      </form>
    </div>

    <p class="mt-3 text-sm text-slate-600">
      Sur la page des ressourcesÂ : checklists (audit des projets, des collectivitÃ©s, des structures publiques),
      bonus (guide des rÃ©ponses), outilsâ€‘pratiques (grilles dâ€™audit, plan dâ€™action correctif), et
      tableau des irrÃ©gularitÃ©s.
    </p>
  </section>

  {% if admin_message %}
    <div class="mt-4 rounded-xl border border-amber-300 bg-amber-50 px-4 py-3 text-amber-900">
      {{ admin_message }}
    </div>
  {% endif %}
</main>
{% endblock %}
